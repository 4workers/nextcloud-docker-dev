version: '2'

services:
  nc-server-sqlite:
    image: juliushaertl/nextcloud-dev
    environment:
      SQL: 'sqlite'
      NEXTCLOUD_AUTOINSTALL:
      NEXTCLOUD_AUTOINSTALL_APPS:
      BLACKFIRE_CLIENT_ID:
      BLACKFIRE_CLIENT_TOKEN:
      BLACKFIRE_SERVER_ID:
      BLACKFIRE_SERVER_TOKEN:
    volumes:
      - '${NEXTCLOUD_SOURCE}:/var/www/html'
      - nc-data-sqlite:/var/www/html/data
      - nc-config-sqlite:/var/www/html/config
      - /var/www/html/apps-writable
    ports:
      - "${NEXTCLOUD_SQLITE_PORT}:80"
    depends_on:
      - nc-cache-redis

  nc-server-mysql:
    image: juliushaertl/nextcloud-dev
    environment:
      SQL: 'mysql'
      NEXTCLOUD_AUTOINSTALL:
      NEXTCLOUD_AUTOINSTALL_APPS:
    volumes:
      - '${NEXTCLOUD_SOURCE}:/var/www/html'
      - nc-data-mysql:/var/www/html/data
      - nc-config-mysql:/var/www/html/config
      - /var/www/html/apps-writable
    ports:
      - "${NEXTCLOUD_MYSQL_PORT}:80"
    depends_on:
      - nc-database-mysql

  nc-server-postgres:
    image: juliushaertl/nextcloud-dev
    environment:
      SQL: 'pgsql'
      NEXTCLOUD_AUTOINSTALL:
      NEXTCLOUD_AUTOINSTALL_APPS:
    volumes:
      - '${NEXTCLOUD_SOURCE}:/var/www/html'
      - nc-data-postgres:/var/www/html/data
      - nc-config-postgres:/var/www/html/config
      - /var/www/html/apps-writable
    ports:
      - "${NEXTCLOUD_POSTGRES_PORT}:80"
    depends_on:
      - nc-database-postgres

  nc-database-mysql:
    image: mariadb:latest
    environment:
      MYSQL_ROOT_PASSWORD: 'nextcloud'
      MYSQL_PASSWORD: 'nextcloud'
      MYSQL_USER: 'nextcloud'
      MYSQL_DATABASE: 'nextcloud'

  nc-database-postgres:
    image: postgres:9
    environment:
      POSTGRES_USER: 'nextcloud'
      POSTGRES_PASSWORD: 'nextcloud'
      POSTGRES_DB: 'nextcloud'
  nc-cache-redis:
    image: redis:3

volumes:
  nc-data-sqlite:
  nc-data-mysql:
  nc-data-postgres:
  nc-config-sqlite:
  nc-config-mysql:
  nc-config-postgres:
  nc-db-postgres:


networks:
  default:
    ipam:
      driver: default
      config:
        - subnet: 192.168.20.0/24
          gateway: 192.168.20.1
